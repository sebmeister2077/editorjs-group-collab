!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.RealtimeCollabPlugin=t():e.RealtimeCollabPlugin=t()}(self,(()=>(()=>{"use strict";var e={424:(e,t,n)=>{n.d(t,{Z:()=>l});var o=n(81),i=n.n(o),r=n(645),c=n.n(r)()(i());c.push([e.id,".codex-editor__redactor {\n    position: relative;\n}\n\n.cdx-realtime-block--selected .ce-block__content {\n    position: relative;\n}\n\n.cdx-realtime-block--selected:not(.ce-block--drop-target) .ce-block__content::before {\n    content: '';\n    position: absolute;\n    inset: 0px;\n    z-index: -1;\n    background-color: #e1f2ff99;\n}\n.cdx-realtime-block--selected .ce-block__content [contenteditable] {\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n}\n.cdx-realtime-block--selected .ce-block__content img,\n.cdx-realtime-block--selected .ce-block__content .ce-stub {\n    opacity: 0.55;\n}\n\n.cdx-realtime-inline-cursor {\n    position: absolute;\n    background-color: var(--realtime-inline-cursor-color, #0d0c0f);\n    width: 1px;\n    height: 1ch;\n    animation: cursor-blink 0.6s infinite alternate ease-in-out;\n}\n\n@keyframes cursor-blink {\n    0%,\n    30% {\n        background-color: var(--realtime-inline-cursor-color, #0d0c0f);\n    }\n    100%,\n    70% {\n        background-color: transparent;\n    }\n}\n",""]);const l=c},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,o,i,r){"string"==typeof e&&(e=[[null,e,void 0]]);var c={};if(o)for(var l=0;l<this.length;l++){var a=this[l][0];null!=a&&(c[a]=!0)}for(var s=0;s<e.length;s++){var d=[].concat(e[s]);o&&c[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},81:e=>{e.exports=function(e){return e[1]}},379:e=>{var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var r={},c=[],l=0;l<e.length;l++){var a=e[l],s=o.base?a[0]+o.base:a[0],d=r[s]||0,u="".concat(s," ").concat(d);r[s]=d+1;var f=n(u),v={css:a[1],media:a[2],sourceMap:a[3],supports:a[4],layer:a[5]};if(-1!==f)t[f].references++,t[f].updater(v);else{var h=i(v,o);o.byIndex=l,t.splice(l,0,{identifier:u,updater:h,references:1})}c.push(u)}return c}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var r=o(e=e||[],i=i||{});return function(e){e=e||[];for(var c=0;c<r.length;c++){var l=n(r[c]);t[l].references--}for(var a=o(e,i),s=0;s<r.length;s++){var d=n(r[s]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=a}}},569:e=>{var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},795:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,i&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={id:o,exports:{}};return e[o](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0;var o={};return(()=>{n.d(o,{default:()=>S});var e=n(379),t=n.n(e),i=n(795),r=n.n(i),c=n(569),l=n.n(c),a=n(565),s=n.n(a),d=n(216),u=n.n(d),f=n(589),v=n.n(f),h=n(424),p={};p.styleTagTransform=v(),p.setAttributes=s(),p.insert=l().bind(null,"head"),p.domAPI=r(),p.insertStyleElement=u(),t()(h.Z,p),h.Z&&h.Z.locals&&h.Z.locals;var b=function(){return b=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},b.apply(this,arguments)},m=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function c(e){try{a(o.next(e))}catch(e){r(e)}}function l(e){try{a(o.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,l)}a((o=o.apply(e,t||[])).next())}))},k=function(e,t){var n,o,i,r,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(l){return function(a){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,l[0]&&(c=0)),c;)try{if(n=1,o&&(i=2&l[0]?o.return:l[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;switch(o=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return c.label++,{value:l[1],done:!1};case 5:c.label++,o=l[1],l=[0];continue;case 7:l=c.ops.pop(),c.trys.pop();continue;default:if(!((i=(i=c.trys).length>0&&i[i.length-1])||6!==l[0]&&2!==l[0])){c=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){c.label=l[1];break}if(6===l[0]&&c.label<i[1]){c.label=i[1],i=l;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(l);break}i[2]&&c.ops.pop(),c.trys.pop();continue}l=t.call(e,c)}catch(e){l=[6,e],o=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,a])}}},g=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n},y="block-selection-change";const S=function(){function e(e){var t=this,n=e.editor,o=e.socket,i=e.socketMethodName,r=g(e,["editor","socket","socketMethodName"]);this.editorBlockEvent="block changed",this.editorDomChangedEvent="redactor dom changed",this._isListening=!1,this.ignoreEvents={},this.handleBlockChange=void 0,this.localBlockStates={},this.blockIdAttributeName="data-id",this.inlineFakeCursorAttributeName="data-realtime-fake-inline-cursor",this.onInlineSelectionChange=function(e){var n=document.getSelection();if(n){var o=n.anchorNode,i=n.anchorOffset,r=n.focusOffset;if(o&&t.isNodeInsideOfEditor(o)){var c=o.parentElement;if(c){var l=n.getRangeAt(0).getBoundingClientRect(),a=t.getContentAndBlockIdFromNode(o);if(a){var s=a.blockId,d=a.contentElement.getBoundingClientRect(),u={top:l.top-d.top,left:l.left-d.left},f=t.getNodeRelativeChildIndex(o);if(null!==f){var v=t.getElementXPath(c),h=b({type:"inline-selection-change",blockId:s,elementXPath:v,anchorOffset:i,focusOffset:r,elementNodeIndex:f},u);t.socket.send(t.socketMethodName,h)}}}}}},this.onReceiveChange=function(e){var n,o,i,r,c,l,a,s,d;switch(e.type){case"block-added":var u=e.index,f=e.block;t.addBlockToIgnoreListUntilNextRender(f.id,e.type),t.editor.blocks.insert(f.tool,f.data,null,u,!1,!1,f.id);break;case"block-changed":var v=e.index,h=e.block;t.addBlockToIgnoreListUntilNextRender(h.id,e.type);var p=null===(o=t.getDOMBlockById(h.id))||void 0===o?void 0:o.classList;t.editor.blocks.update(h.id,h.data).catch((function(e){e.message==='Block with id "'.concat(h.id,'" not found')&&(t.addBlockToIgnoreListUntilNextRender(h.id,"block-added"),t.editor.blocks.insert(h.tool,h.data,null,v,!1,!1,h.id))})).then((function(){var e,n,o;(null==p?void 0:p.contains(t.CSS.selected))&&(null===(e=t.getDOMBlockById(h.id))||void 0===e||e.classList.add(t.CSS.selected,null!==(o=null===(n=t.config.overrideStyles)||void 0===n?void 0:n.selectedClass)&&void 0!==o?o:""))}));break;case"block-moved":var b=e.toBlockId,m=e.fromBlockId,k=e.toBlockIndex,y=t.editor.blocks.getBlockIndex(b),S=t.editor.blocks.getBlockIndex(m);if(k===S)return;t.addBlockToIgnoreListUntilNextRender(m,e.type),t.editor.blocks.move(y,S);break;case"block-removed":var I=e.blockId;t.addBlockToIgnoreListUntilNextRender(I,e.type);var x=t.editor.blocks.getBlockIndex(I);t.editor.blocks.delete(x);break;case"block-selection-change":I=e.blockId;var E=e.isSelected;if(t.addBlockToIgnoreListUntilNextRender(I,e.type),!(f=t.getDOMBlockById(I)))return;E?f.classList.add(t.CSS.selected,null!==(r=null===(i=t.config.overrideStyles)||void 0===i?void 0:i.selectedClass)&&void 0!==r?r:""):f.classList.remove(t.CSS.selected,null!==(l=null===(c=t.config.overrideStyles)||void 0===c?void 0:c.selectedClass)&&void 0!==l?l:"");break;case"inline-selection-change":e.type,e.anchorOffset,e.elementNodeIndex;var C=e.elementXPath,B=(e.focusOffset,I=e.blockId,g(e,["type","anchorOffset","elementNodeIndex","elementXPath","focusOffset","blockId"])),N=null===(a=t.getDOMBlockById(I))||void 0===a?void 0:a.querySelector(".".concat(t.EditorCSS.blockContent));if(!N)return;var L=null===C,w=t.getFakeCursor(I),O=w.cursor,T=w.isInDocument;if(L)return void(T&&O.remove());var M=document.querySelector(C);if(!(M instanceof HTMLElement))return;var A=window.getComputedStyle(M).fontSize;O.style.height=A,O.style.top="".concat(B.top,"px"),O.style.left="".concat(B.left,"px");var R=(null!==(s=t.config.overrideStyles)&&void 0!==s?s:{}).cursorClass,_=(null!==(d=t.config.cursor)&&void 0!==d?d:{}).color;_&&O.style.setProperty("--realtime-inline-cursor-color",_),R&&(n=O.classList).add.apply(n,R.split(" ")),T||N.append(O)}},this.onEditorBlockEvent=function(e){var n;if((null==e?void 0:e.event)instanceof CustomEvent&&e.event){var o=e.event;if(t.validateEventDetail(o)){var i=o.type,r=o.detail,c=r.target,l=g(r,["target"]);l.type=i;var a=c.id;(null===(n=t.ignoreEvents[a])||void 0===n?void 0:n.has(i))||setTimeout((function(){return m(t,void 0,void 0,(function(){var e,t,n,o,r,s,d,u,f=this;return k(this,(function(v){switch(v.label){case 0:return"block-changed"===i?"index"in l&&"number"==typeof l.index?(null===(s=this.handleBlockChange)||void 0===s||s.call(this,c,null!==(d=l.index)&&void 0!==d?d:0),setTimeout((function(){f.onInlineSelectionChange(new CustomEvent("selectionchange"))}),0),[2]):[2]:[4,c.save()];case 1:return(e=v.sent())?("block-added"===(t={type:i,block:e}).type&&(t.index=l.index),"block-removed"===t.type&&(t.blockId=a),"block-moved"===t.type&&(o=(n=l).fromIndex,r=n.toIndex,t.fromBlockId=a,t.toBlockIndex=r,t.toBlockId=null===(u=this.editor.blocks.getBlockByIndex(o))||void 0===u?void 0:u.id),this.socket.send(this.socketMethodName,t),[2]):[2]}}))}))}),0)}}else console.error("block changed but its not custom event")},this.editor=n,this.socket=o,this.socketMethodName=null!=i?i:"editorjs-update",this.config=b(b({},{blockChangeThrottleDelay:300}),null!=r?r:{}),this.observer=new MutationObserver((function(e,n){for(var o=0,i=e;o<i.length;o++){var r=i[o];t.handleMutation(r)}})),this.initBlockChangeListener()}return Object.defineProperty(e.prototype,"isListening",{get:function(){return this._isListening},enumerable:!1,configurable:!0}),e.prototype.unlisten=function(){this.socket.off(this.socketMethodName),this.editor.off(this.editorBlockEvent,this.onEditorBlockEvent),this.observer.disconnect(),document.removeEventListener("selectionchange",this.onInlineSelectionChange),this._isListening=!1},e.prototype.listen=function(){var e,t,n,o;this.socket.on(this.socketMethodName,this.onReceiveChange),this.editor.on(this.editorBlockEvent,this.onEditorBlockEvent);var i=null!==(o=null!==(t=null===(e=this.editor)||void 0===e?void 0:e.ui.redactor)&&void 0!==t?t:document.querySelector("#".concat(null===(n=this.editor)||void 0===n?void 0:n.configuration.holder," .").concat(this.EditorCSS.editorRedactor)))&&void 0!==o?o:document.querySelector(".".concat(this.EditorCSS.editorRedactor));this.observer.observe(i,{childList:!0,attributes:!0,attributeFilter:["class"],subtree:!0}),document.addEventListener("selectionchange",this.onInlineSelectionChange),this._isListening=!0},Object.defineProperty(e.prototype,"CSS",{get:function(){return{selected:"cdx-realtime-block--selected",inlineCursor:"cdx-realtime-inline-cursor"}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"EditorCSS",{get:function(){return{baseBlock:"ce-block",focused:"ce-block--focused",selected:"ce-block--selected",editorRedactor:"codex-editor__redactor",blockContent:"ce-block__content"}},enumerable:!1,configurable:!0}),e.prototype.handleMutation=function(e){var t,n,o,i;if("attributes"===e.type){var r=e.target;if(r instanceof HTMLElement){var c=r.classList.contains(this.EditorCSS.selected),l=(r.classList.contains(this.EditorCSS.focused),r.getAttribute(this.blockIdAttributeName));if(l){if((null===(t=this.localBlockStates[l])||void 0===t?void 0:t.has("selected"))!=c){if(null===(n=this.ignoreEvents[l])||void 0===n?void 0:n.has(y))return;null!==(o=(i=this.localBlockStates)[l])&&void 0!==o||(i[l]=new Set),c?this.localBlockStates[l].add("selected"):this.localBlockStates[l].delete("selected"),this.socket.send(this.socketMethodName,{type:y,blockId:l,isSelected:c})}this.localBlockStates[l].size||delete this.localBlockStates[l]}}}},e.prototype.initBlockChangeListener=function(){var e=this;this.handleBlockChange=function(e,t,n){var o,i=n||{},r=i.noTrailing,c=void 0!==r&&r,l=i.noLeading,a=void 0!==l&&l,s=i.debounceMode,d=void 0===s?void 0:s,u=!1,f=0;function v(){o&&clearTimeout(o)}function h(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];var l=this,s=Date.now()-f;function h(){f=Date.now(),t.apply(l,i)}function p(){o=void 0}u||(a||!d||o||h(),v(),void 0===d&&s>e?a?(f=Date.now(),c||(o=setTimeout(d?p:h,e))):h():!0!==c&&(o=setTimeout(d?p:h,void 0===d?e-s:e)))}return h.cancel=function(e){var t=(e||{}).upcomingOnly,n=void 0!==t&&t;v(),u=!n},h}(this.config.blockChangeThrottleDelay,(function(t,n){return m(e,void 0,void 0,(function(){var e,o,i;return k(this,(function(r){switch(r.label){case 0:return this.isListening?(e=t.id,[4,t.save()]):[2];case 1:return(o=r.sent())?(i={type:"block-changed",block:o,index:n},this.isListening?(this.socket.send(this.socketMethodName,i),this.addBlockToIgnoreListUntilNextRender(e,"block-changed"),[2]):[2]):[2]}}))}))}))},e.prototype.getFakeCursor=function(e){var t,n=document.querySelector("[".concat(this.blockIdAttributeName,"='").concat(e,"'] .").concat(this.EditorCSS.blockContent," [").concat(this.inlineFakeCursorAttributeName,"]"));if(n instanceof HTMLElement)return{cursor:n,isInDocument:!0};null===(t=document.querySelector("[".concat(this.inlineFakeCursorAttributeName,"]")))||void 0===t||t.remove();var o=document.createElement("div");return o.setAttribute(this.inlineFakeCursorAttributeName,""),o.classList.add(this.CSS.inlineCursor),{cursor:o,isInDocument:!1}},e.prototype.validateEventDetail=function(e){return"object"==typeof e.detail&&e.detail&&("index"in e.detail&&"number"==typeof e.detail.index||"fromIndex"in e.detail&&"number"==typeof e.detail.fromIndex&&"toIndex"in e.detail&&"number"==typeof e.detail.toIndex)&&"target"in e.detail&&"object"==typeof e.detail.target&&e.detail.target},e.prototype.addBlockToIgnoreListUntilNextRender=function(e,t){var n=this;this.addBlockToIgnorelist(e,t),setTimeout((function(){n.removeBlockFromIgnorelist(e,t)}),0)},e.prototype.addBlockToIgnorelist=function(e,t){this.ignoreEvents[e]||(this.ignoreEvents[e]=new Set),this.ignoreEvents[e].add(t)},e.prototype.removeBlockFromIgnorelist=function(e,t){this.ignoreEvents[e]&&(this.ignoreEvents[e].delete(t),this.ignoreEvents[e].size||delete this.ignoreEvents[e])},e.prototype.getDOMBlockById=function(e){var t=document.querySelector("[".concat(this.blockIdAttributeName,"='").concat(e,"']"));return t instanceof HTMLElement?t:null},e.prototype.getRedactor=function(){var e=document.querySelector(".".concat(this.EditorCSS.editorRedactor));return e instanceof HTMLElement?e:null},e.prototype.getContentAndBlockIdFromNode=function(e){var t,n=this;if(!this.isNodeInsideOfEditor(e))return null;for(var o=e.parentElement,i=function(e){var t;return(null==e?void 0:e.classList.contains(n.EditorCSS.blockContent))&&(null===(t=null==e?void 0:e.parentElement)||void 0===t?void 0:t.classList.contains(n.EditorCSS.baseBlock))&&(null==e?void 0:e.parentElement.hasAttribute(n.blockIdAttributeName))};o&&!i(o);)o=o.parentElement;if(!o)return null;var r=null===(t=o.parentElement)||void 0===t?void 0:t.getAttribute(this.blockIdAttributeName);return r?{contentElement:o,blockId:r}:null},e.prototype.isNodeInsideOfEditor=function(e){var t,n,o,i,r,c,l=null===(o=null===(n=null===(t=this.editor)||void 0===t?void 0:t.ui)||void 0===n?void 0:n.nodes)||void 0===o?void 0:o.redactor;if(l instanceof HTMLElement)return l.contains(e);var a=null===(r=null===(i=this.editor)||void 0===i?void 0:i.configuration)||void 0===r?void 0:r.holder;if(a&&"string"==typeof a)return null===(c=document.getElementById(a))||void 0===c?void 0:c.contains(e);for(var s=e.parentElement;s&&s!==document.body;){var d=s.getAttribute(this.blockIdAttributeName),u=s.classList.contains(this.EditorCSS.baseBlock),f=d&&Boolean(this.editor.blocks.getById(d));if(u&&f)return!0;s=s.parentElement}return!1},e.prototype.getElementXPath=function(e){for(var t=e,n=[];t.parentNode instanceof HTMLElement&&!t.classList.contains(this.EditorCSS.editorRedactor);){var o=t.getAttribute(this.blockIdAttributeName),i=t.localName.toLowerCase();if(o&&(i+="[".concat(this.blockIdAttributeName,"='").concat(o,"']")),t.previousElementSibling){for(var r=t,c=1;r=r.previousElementSibling;)c++;i+=":nth-child(".concat(c,")")}n.unshift(i),t=t.parentNode}return n.unshift(".".concat(this.EditorCSS.editorRedactor)),n.join(" > ")},e.prototype.getNodeRelativeChildIndex=function(e){var t=e.parentElement;if(!t)return null;for(var n=0;n<t.childNodes.length;n++)if(e===t.childNodes[n])return n;return null},e}()})(),o.default})()));